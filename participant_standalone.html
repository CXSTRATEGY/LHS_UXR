<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡¯ë°í™ˆì‡¼í•‘ "í˜œíƒ" ë§¤ì¥ ì¹´ë“œ ë¶„ë¥˜í•˜ê¸°</title>
    <style>
        /* ê³µí†µ ìŠ¤íƒ€ì¼ + ì°¸ì—¬ì ì „ìš© ìŠ¤íƒ€ì¼ */
        
        /* ê¸°ë³¸ ë¦¬ì…‹ ë° ì „ì—­ ì„¤ì • */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', 'Apple SD Gothic Neo', Roboto, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            background-attachment: fixed;
            background-size: cover;
            min-height: 100vh; 
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container { 
            width: 100%;
            max-width: 1400px; 
            min-width: 320px;
            margin: 0 auto; 
            padding: 10px; 
            min-height: 100vh;
        }
        
        /* ê¸°ë³¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card { 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            overflow: hidden;
        }
        
        /* í˜ì´ì§€ ì „í™˜ */
        .page { 
            display: none; 
            animation: fadeIn 0.3s ease-in;
        }
        
        .page.active { display: block; }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group { margin: 20px 0; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-control { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #e1e5e9; 
            border-radius: 8px; 
            font-size: 16px; 
            transition: border-color 0.3s;
        }
        .form-control:focus { 
            outline: none; 
            border-color: #667eea; 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn { 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s; 
            text-decoration: none; 
            display: inline-block; 
            text-align: center;
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary { 
            background: #e9ecef; 
            color: #495057; 
            border: 1px solid #ced4da; 
        }
        
        .btn-secondary:hover { 
            background: #dee2e6; 
        }
        
        .btn-danger { 
            background: #e74c3c; 
            color: white; 
        }
        
        .btn-danger:hover { 
            background: #c0392b; 
        }
        
        /* ë¡œê·¸ì¸ ìŠ¤íƒ€ì¼ */
        .login-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            padding: 20px; 
        }
        
        .login-box { 
            background: white; 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            width: 100%; 
            max-width: 400px;
        }
        
        .login-title { 
            text-align: center; 
            font-size: 20px; 
            font-weight: bold; 
            color: #333; 
            margin-bottom: 10px; 
        }
        
        .login-subtitle { 
            text-align: center; 
            color: #666; 
            margin-bottom: 30px; 
        }
        
        /* ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
        .alert { 
            padding: 12px 16px; 
            border-radius: 8px; 
            margin: 15px 0; 
            border-left: 4px solid;
        }
        
        .alert-info { 
            background: #e3f2fd; 
            border-color: #2196f3; 
            color: #1976d2; 
        }
        
        .alert-warning { 
            background: #fff3e0; 
            border-color: #ff9800; 
            color: #f57c00; 
        }
        
        .alert-success { 
            background: #e8f5e9; 
            border-color: #4caf50; 
            color: #388e3c; 
        }
        
        /* í™˜ì˜ í˜ì´ì§€ */
        .welcome-container { 
            text-align: center; 
            padding: 60px 30px; 
        }
        
        .welcome-message { 
            background: white; 
            padding: 40px; 
            border-radius: 12px; 
            margin-bottom: 30px; 
            line-height: 1.8; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .welcome-message h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        /* ì¹´ë“œ ì†ŒíŒ… í—¤ë” */
        .sorting-header { 
            background: white; 
            padding: 20px 30px; 
            border-bottom: 1px solid #eee; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-wrap: wrap; 
            gap: 15px; 
        }
        
        .participant-info h2 { 
            color: #333; 
            font-size: 20px; 
        }
        
        .participant-info p { 
            color: #666; 
            font-size: 14px; 
        }
        
        .progress-section { 
            display: flex; 
            flex-direction: column; 
            align-items: flex-end; 
            min-width: 200px; 
        }
        
        .progress-bar { 
            width: 200px; 
            height: 8px; 
            background: #e9ecef; 
            border-radius: 4px; 
            overflow: hidden;
        }
        
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #667eea, #764ba2); 
            transition: width 0.3s ease; 
        }
        
        .progress-text { 
            text-align: center; 
            font-size: 14px; 
            color: #666; 
            margin-top: 5px; 
        }
        
        /* ì¹´ë“œ ì†ŒíŒ… ì›Œí¬ìŠ¤í˜ì´ìŠ¤ */
        .sorting-workspace { 
            display: grid; 
            grid-template-columns: 320px 1fr;
            gap: 30px; 
            padding: 30px; 
            min-height: calc(100vh - 200px); 
        }
        
        /* ë¯¸ë¶„ë¥˜ ì¹´ë“œ ì˜ì—­ */
        .card-pool { 
            background: #fff9e6; 
            border-radius: 12px; 
            padding: 20px; 
            border: 2px dashed #f0ad4e; 
            transition: all 0.3s;
        }
        
        .card-pool.drag-over { 
            border-color: #f0ad4e; 
            background: #fff3cd; 
            transform: scale(1.02); 
        }
        
        .card-pool h3 { 
            color: #8a6d3b; 
            margin-bottom: 15px; 
            font-size: 18px; 
            font-weight: 600;
        }
        
        .card-list { 
            max-height: 500px; 
            overflow-y: auto; 
            margin-bottom: 15px; 
        }
        
        .card-item { 
            background: white; 
            padding: 12px 15px; 
            margin: 8px 0; 
            border-radius: 8px; 
            border: 1px solid #dee2e6; 
            cursor: move; 
            transition: all 0.2s; 
            position: relative; 
            user-select: none; 
            font-size: 14px;
        }
        
        .card-item:hover { 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
            transform: translateY(-2px);
        }
        
        .card-item.dragging { 
            opacity: 0.5; 
            transform: rotate(5deg); 
        }
        
        .card-item::after { 
            content: "â‹®â‹®"; 
            position: absolute; 
            right: 10px; 
            top: 50%; 
            transform: translateY(-50%); 
            color: #adb5bd; 
            font-weight: bold; 
        }
        
        /* ê·¸ë£¹ ì˜ì—­ */
        .groups-area { 
            background: white; 
        }
        
        .groups-header { 
            padding: 20px; 
            border-bottom: 1px solid #eee; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .group-order-guide {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #1976d2;
            text-align: center;
        }
        
        .groups-container { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr);
            gap: 20px; 
            max-height: 70vh; 
            overflow-y: auto; 
            padding: 20px; 
        }
        
        .group-container { 
            background: #f8f9fa; 
            border: 2px dashed #667eea; 
            border-radius: 12px; 
            padding: 15px; 
            min-height: 200px; 
            transition: all 0.3s;
            position: relative;
        }
        
        .group-container.drag-over { 
            border-color: #28a745; 
            background: #f8fff8; 
            transform: scale(1.02); 
        }
        
        .group-container.dragging-group {
            opacity: 0.7;
            transform: rotate(2deg);
            z-index: 1000;
        }
        
        .group-drag-handle {
            position: absolute;
            top: 8px;
            left: 8px;
            width: 24px;
            height: 24px;
            cursor: move;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            opacity: 0.7;
            transition: all 0.2s;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        
        .group-container:hover .group-drag-handle {
            opacity: 1;
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.1);
        }
        
        .group-meta-info {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
            z-index: 10;
        }
        
        .group-rank {
            background: #667eea;
            color: white;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .group-card-count {
            background: #28a745;
            color: white;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .group-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
            padding-bottom: 10px; 
            border-bottom: 1px solid #dee2e6; 
            padding-top: 35px;
            padding-right: 80px;
        }
        
        .group-title { 
            font-weight: 600; 
            color: #333; 
            flex: 1; 
        }
        
        .group-title.editable { 
            cursor: pointer; 
            padding: 4px 8px; 
            border-radius: 4px; 
            transition: background 0.2s;
        }
        
        .group-title.editable:hover { 
            background: #e9ecef; 
        }
        
        .group-actions { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        .delete-group-btn { 
            background: #e74c3c; 
            color: white; 
            border: none; 
            width: 24px; 
            height: 24px; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: 14px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
        }
        
        .group-content { 
            min-height: 120px; 
        }
        
        .empty-group { 
            text-align: center; 
            color: #adb5bd; 
            padding: 40px 20px; 
            font-style: italic; 
        }
        
        .group-content .card-item { 
            margin: 8px 0; 
        }
        
        .sorting-actions { 
            background: white; 
            padding: 20px 30px; 
            border-top: 1px solid #eee; 
            display: flex; 
            justify-content: center; 
            gap: 25px; 
            flex-wrap: wrap; 
        }
        
        /* ì„¤ë¬¸ í˜ì´ì§€ */
        .survey-container { 
            padding: 30px; 
        }
        
        .survey-header { 
            text-align: center; 
            margin-bottom: 30px; 
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #dee2e6;
        }
        
        .survey-header h2 { 
            color: #333; 
            font-size: 24px; 
            margin-bottom: 15px; 
        }
        
        .survey-drag-layout {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            min-height: 500px;
            margin-bottom: 30px;
        }
        
        .survey-drop-zone {
            background: white;
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
            position: relative;
            transition: all 0.3s;
        }
        
        .survey-drop-zone.drag-over {
            border-color: #667eea;
            background: #f8f9ff;
            transform: scale(1.02);
        }
        
        .drop-zone-header {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 16px;
        }
        
        .drop-zone-left .drop-zone-header {
            background: #e3f2fd;
            color: #1976d2;
            border: 2px solid #2196f3;
        }
        
        .drop-zone-right .drop-zone-header {
            background: #ffebee;
            color: #d32f2f;
            border: 2px solid #f44336;
        }
        
        .survey-cards-center {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #dee2e6;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .survey-center-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .survey-center-header h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .survey-progress-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        /* ì˜ê²¬ ìˆ˜ì§‘ í˜ì´ì§€ */
        .feedback-container { 
            padding: 30px; 
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        
        .feedback-header { 
            grid-column: 1 / -1;
            text-align: center; 
            margin-bottom: 30px; 
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #dee2e6;
        }
        
        .feedback-header h2 { 
            color: #333; 
            font-size: 24px; 
            margin-bottom: 15px; 
        }
        
        .feedback-left, .feedback-right {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }
        
        .feedback-left h3, .feedback-right h3 {
            color: #667eea;
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .feedback-textarea { 
            min-height: 300px; 
            resize: vertical; 
            font-family: inherit;
            line-height: 1.6;
            font-size: 14px;
            flex: 1;
        }
        
        .char-counter { 
            text-align: right; 
            font-size: 14px; 
            color: #666; 
            margin-top: 5px; 
        }
        
        .char-counter.warning { 
            color: #f57c00; 
        }
        
        .char-counter.danger { 
            color: #e74c3c; 
        }
        
        .feedback-actions {
            grid-column: 1 / -1;
            text-align: center;
            margin-top: 20px;
        }
        
        /* ì™„ë£Œ í˜ì´ì§€ */
        .completion-container { 
            text-align: center; 
            padding: 60px 30px; 
        }
        
        .completion-message { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 40px; 
            border-radius: 12px; 
            margin-bottom: 40px;
        }
        
        .completion-message h2 { 
            font-size: 32px; 
            margin-bottom: 15px; 
        }
        
        /* ëª¨ë‹¬ */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 1000; 
            align-items: center; 
            justify-content: center; 
        }
        
        .modal.show { 
            display: flex; 
        }
        
        .modal-content { 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            max-width: 700px; 
            width: 90%; 
            max-height: 80vh; 
            overflow-y: auto;
        }
        
        /* ìœ í‹¸ë¦¬í‹° */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-2 { margin-top: 10px; }
        .mt-3 { margin-top: 15px; }
        .mb-2 { margin-bottom: 10px; }
        .mb-3 { margin-bottom: 15px; }
        .flex { display: flex !important; }
        .gap-2 { gap: 10px; }
        .gap-3 { gap: 15px; }
        .justify-center { justify-content: center; }
        .items-center { align-items: center; }
        .w-full { width: 100%; }
        
        /* ì•Œë¦¼ í† ìŠ¤íŠ¸ */
        .notification {
            position: fixed;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            max-width: 500px;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            font-weight: 600;
            font-size: 16px;
            animation: slideInDown 0.3s ease-out;
            border: 2px solid;
        }
        
        @keyframes slideInDown {
            from { opacity: 0; transform: translateX(-50%) translateY(-30px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) { 
            .sorting-workspace { 
                grid-template-columns: 1fr; 
                gap: 20px; 
                padding: 20px; 
            } 
            
            .groups-container { 
                grid-template-columns: 1fr;
            } 
            
            .groups-header { 
                flex-direction: column; 
                gap: 10px; 
            } 
            
            .sorting-header { 
                flex-direction: column; 
                text-align: center; 
            } 
            
            .feedback-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .survey-drag-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .survey-progress-info {
                padding: 15px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 1024px) {
            .groups-container { 
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }
        
        @media screen and (max-width: 1366px) {
            .sorting-workspace {
                grid-template-columns: 280px 1fr;
                gap: 20px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì°¸ì—¬ì í™˜ì˜ í˜ì´ì§€ -->
        <div id="welcome-page" class="page active">
            <div class="welcome-container">
                <div class="welcome-message">
                    <h1 style="color: #333; margin-bottom: 30px;">ì•ˆë…•í•˜ì„¸ìš”!</h1>
                    <p style="margin-bottom: 20px;">ë¡¯ë°í™ˆì‡¼í•‘ ì˜¨ë¼ì¸ ë¦¬ì„œì¹˜ì— ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.</p>
                    <p style="margin-bottom: 20px;">ì¹´ë“œ ë¶„ë¥˜í•˜ê¸°ëŠ” ì•½ 10ë¶„ ë‚´ì™¸ì˜ ì‹œê°„ì´ ì†Œìš”ë©ë‹ˆë‹¤.</p>
                    <p style="margin-bottom: 20px;">í•˜ë‹¨ì˜ 'ë¦¬ì„œì¹˜ ì°¸ì—¬í•˜ê¸°' ë²„íŠ¼ì„ ëˆ„ë¥´ì‹  í›„ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´, ë¦¬ì„œì¹˜ ì°¸ì—¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                    <p style="font-weight: 600;">ì¹´ë“œ ë¶„ë¥˜ë¥¼ ì™„ë£Œí•˜ì‹  í›„ì—ëŠ” "ì‘ë‹µ ì œì¶œí•˜ê¸°" ë²„íŠ¼ì„ ê¼­ ëˆŒëŸ¬ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤.</p>
                </div>
                <button class="btn btn-primary" style="font-size: 18px; padding: 15px 30px;" onclick="showParticipantLogin()">
                    ë¦¬ì„œì¹˜ ì°¸ì—¬í•˜ê¸°
                </button>
            </div>
        </div>

        <!-- ì°¸ì—¬ì ë¡œê·¸ì¸ -->
        <div id="participant-login-page" class="page">
            <div class="login-container">
                <div class="login-box">
                    <h1 class="login-title" id="participant-project-title">ì°¸ì—¬ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</h1>
                    
                    <form onsubmit="participantLogin(event)">
                        <div class="form-group">
                            <label class="form-label">ì´ë¦„</label>
                            <input 
                                type="text" 
                                id="participant-name" 
                                class="form-control" 
                                placeholder="í™ê¸¸ë™"
                                pattern="[ê°€-í£]+"
                                title="í•œê¸€ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label">íœ´ëŒ€í° ë’·ë²ˆí˜¸ 4ìë¦¬</label>
                            <input 
                                type="text" 
                                id="participant-phone" 
                                class="form-control" 
                                placeholder="1234"
                                pattern="[0-9]{4}"
                                maxlength="4"
                                title="ìˆ«ì 4ìë¦¬ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                required
                            >
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-full">
                            ì‹œì‘í•˜ê¸°
                        </button>
                    </form>

                    <div id="existing-response-notice" class="alert alert-warning mt-3 hidden">
                        <strong>âš ï¸ ê¸°ì¡´ ì‘ë‹µ ë°œê²¬</strong><br>
                        ì´ì „ì— ì§„í–‰í•˜ë˜ ì‘ë‹µì´ ìˆìŠµë‹ˆë‹¤. ì´ì–´ì„œ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                        <div class="flex gap-2 mt-2">
                            <button class="btn btn-secondary" onclick="continueExisting()">ì´ì–´ì„œ í•˜ê¸°</button>
                            <button class="btn btn-danger" onclick="startNew()">ìƒˆë¡œ ì‹œì‘</button>
                        </div>
                    </div>

                    <div class="alert alert-success mt-3">
                        <strong>ğŸ“‹ ì°¸ì—¬ ì•ˆë‚´:</strong><br>
                        â€¢ ì˜ˆìƒ ì†Œìš”ì‹œê°„: ì•½ 10ë¶„<br>
                        â€¢ ì´ì–´ì§€ëŠ” í™”ë©´ì—ì„œ 'ì¹´ë“œ ë¶„ë¥˜í•˜ê¸° ì•ˆë‚´ì„œ'ê°€ ì œê³µë©ë‹ˆë‹¤<br>
                    </div>

                    <div class="text-center mt-3">
                        <button class="btn btn-secondary" onclick="showWelcomePage()">
                            â† ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì¹´ë“œì†ŒíŒ… ë©”ì¸ í™”ë©´ -->
        <div id="sorting-page" class="page">
            <div class="card">
                <div class="sorting-header">
                    <div class="participant-info">
                        <h2 id="sorting-participant-name">ì°¸ì—¬ìë‹˜ì˜ ì¹´ë“œì†ŒíŒ…</h2>
                        <p id="sorting-type-info">í•˜ì´ë¸Œë¦¬ë“œ ì†ŒíŒ… ì§„í–‰ ì¤‘</p>
                    </div>
                    <div class="progress-section">
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
                            </div>
                            <div class="progress-text" id="progress-text">
                                ì§„í–‰ ìƒí™©ì„ í™•ì¸í•˜ì„¸ìš”
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sorting-workspace">
                    <div class="card-pool">
                        <h3>ğŸƒ ë¯¸ë¶„ë¥˜ ì¹´ë“œ (<span id="unassigned-count">0</span>ê°œ)</h3>
                        <div class="card-list" id="card-pool"></div>
                    </div>

                    <div class="groups-area">
                        <div class="groups-header">
                            <button 
                                class="btn btn-secondary" 
                                onclick="showSortingGuide()"
                            >
                                ğŸ“– ì¹´ë“œ ë¶„ë¥˜í•˜ê¸° ì•ˆë‚´ì„œ
                            </button>
                            <button 
                                class="btn btn-secondary" 
                                id="create-group-btn" 
                                onclick="createNewGroup()"
                            >
                                â• ìƒˆ ê·¸ë£¹ ë§Œë“¤ê¸°
                            </button>
                        </div>
                        
                        <div class="group-order-guide">
                            ğŸ’¡ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ì‹œëŠ” ê·¸ë£¹ìˆœìœ¼ë¡œ ë°°ì—´í•´ë³´ì„¸ìš”! ê·¸ë£¹ ì œëª©ì„ ë“œë˜ê·¸í•´ì„œ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”.
                        </div>
                        
                        <div class="groups-container" id="groups-container"></div>
                    </div>
                </div>

                <div class="sorting-actions">
                    <button class="btn btn-secondary" onclick="returnToLogin()">
                        â† ë¡œê·¸ì¸ìœ¼ë¡œ
                    </button>
                    <button class="btn btn-secondary" onclick="resetAllCards()">
                        ğŸ”„ ì „ì²´ ì´ˆê¸°í™”
                    </button>
                    <button class="btn btn-secondary" onclick="autoSave()">
                        ğŸ’¾ ì„ì‹œ ì €ì¥
                    </button>
                    <button class="btn btn-primary" onclick="submitSorting()" id="submit-btn">
                        âœ… ì‘ë‹µ ì œì¶œí•˜ê¸°
                    </button>
                </div>
            </div>
        </div>

        <!-- ì„¤ë¬¸ ì‘ë‹µí•˜ê¸° í˜ì´ì§€ -->
        <div id="survey-page" class="page">
            <div class="card">
                <div class="survey-container">
                    <div class="survey-header">
                        <h2>ì™€! ì •ë§ ë©‹ì§„ ì¹´ë“œë¶„ë¥˜ê°€ ì™„ì„±ë˜ì—ˆëŠ”ë°ìš”! ëª‡ê°€ì§€ë§Œ ì§ˆë¬¸ ë“œë¦´ê²Œìš”!</h2>
                        <p style="color: #666; margin-top: 10px;">ì•„ë˜ ì¹´ë“œë“¤ì„ ì¢Œìš°ë¡œ ë“œë˜ê·¸í•´ì„œ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                    </div>

                    <div class="survey-progress-info">
                        <div style="text-align: center; font-size: 16px; color: #333; font-weight: 600;">
                            ì§€ê¸ˆê¹Œì§€ ë¶„ë¥˜í•´ì£¼ì‹  ì¹´ë“œ ì¤‘ 'ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” í˜œíƒ'ê³¼ 'ê°€ì¥ ì ê²Œ ì‚¬ìš©í•˜ëŠ” í˜œíƒ'ì„ ê°ê° 3ê°œì”© ë¶„ë¥˜í•´ì£¼ì„¸ìš”.
                        </div>
                    </div>

                    <div class="survey-drag-layout">
                        <div class="survey-drop-zone drop-zone-left" id="q1-drop-zone">
                            <div class="drop-zone-header">
                                ğŸ”µ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” í˜œíƒ<br>
                                <span id="q1-progress-display">0/3ê°œ</span>
                            </div>
                            <div class="drop-zone-content" id="q1-cards">
                                <div class="drop-zone-empty">ì¹´ë“œë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                            </div>
                        </div>

                        <div class="survey-cards-center">
                            <div class="survey-center-header">
                                <h3>ë¶„ë¥˜í•˜ì‹  ì¹´ë“œë“¤</h3>
                                <p>ì¹´ë“œë¥¼ ì¢Œìš°ë¡œ ë“œë˜ê·¸í•´ì„œ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                            </div>
                            <div id="survey-center-groups">
                                <!-- ê·¸ë£¹ë³„ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>

                        <div class="survey-drop-zone drop-zone-right" id="q2-drop-zone">
                            <div class="drop-zone-header">
                                ğŸ”´ ê°€ì¥ ì ê²Œ ì‚¬ìš©í•˜ëŠ” í˜œíƒ<br>
                                <span id="q2-progress-display">0/3ê°œ</span>
                            </div>
                            <div class="drop-zone-content" id="q2-cards">
                                <div class="drop-zone-empty">ì¹´ë“œë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                            </div>
                        </div>
                    </div>

                    <div class="text-center mt-3" style="border-top: 1px solid #eee; padding-top: 20px;">
                        <div class="flex gap-3 justify-center">
                            <button class="btn btn-secondary" onclick="returnToSorting()">
                                â† ì¹´ë“œ ë¶„ë¥˜ë¡œ ëŒì•„ê°€ê¸°
                            </button>
                            <button class="btn btn-primary" onclick="submitSurvey()" id="survey-submit-btn">
                                ì‘ë‹µ ì œì¶œí•˜ê¸°
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì˜ê²¬ ìˆ˜ì§‘ í˜ì´ì§€ -->
        <div id="feedback-page" class="page">
            <div class="card">
                <div class="feedback-container">
                    <div class="feedback-header">
                        <h2>ìˆ˜ê³  ë§ìœ¼ì…¨ì–´ìš”! ì—¬ëŸ¬ë¶„ì˜ ì°¸ì—¬ëŠ” í° ë„ì›€ì´ ë  ê±°ì—ìš”.</h2>
                        <p style="color: #666; font-size: 16px; margin-top: 10px;">ë§ˆì§€ë§‰ìœ¼ë¡œ ì§€ê¸ˆê¹Œì§€ 'ì¹´ë“œ ë¶„ë¥˜í•˜ê¸°'ë¥¼ ì§„í–‰í•˜ë©´ì„œ ëŠë‚€ ì ì„ ììœ ë¡­ê²Œ ë“¤ë ¤ì£¼ì„¸ìš”!</p>
                    </div>

                    <div class="feedback-left">
                        <h3>ì´ë ‡ê²Œ ì‘ë‹µí•˜ì…¨ì–´ìš”!</h3>
                        <div class="sorting-result-display" id="sorting-result-display">
                            <!-- ì°¸ì—¬ìì˜ ê·¸ë£¨í•‘ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>

                    <div class="feedback-right">
                        <h3>ì–´ë–¤ ì˜ê²¬ì´ë“  ë„ì›€ì´ ë ê±°ì—ìš”!</h3>
                        <div class="form-group">
                            <textarea 
                                id="participant-feedback" 
                                class="form-control feedback-textarea" 
                                placeholder="&#10;ë¬´ì—‡ì„ ì‘ì„±í•´ì•¼í• ì§€ ëª¨ë¥´ê² ë‹¤ë©´ ë‹¤ìŒ ë‚´ìš©ë“¤ì„ ì°¸ê³ í•´ì£¼ì…”ë„ ì¢‹ì•„ìš” : D&#10;-'ì¹´ë“œ ë¶„ë¥˜í•˜ê¸°'ë¼ëŠ” ê³¼ì •ì„ ì°¸ì—¬í•˜ë©´ì„œ ëŠë‚€ ì !&#10;-ì¹´ë“œë¥¼ ë¶„ë¥˜í•  ë•Œ, ì¤‘ìš”í•˜ê²Œ ì‹ ê²½ì¼ë˜ ì  í˜¹ì€ ì–´ë ¤ì› ë˜ ì !&#10;-ì¹´ë“œì˜ ê·¸ë£¹ëª…ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì¶”ê°€í•˜ì…¨ë‹¤ë©´, ê·¸ ì´ìœ !"
                                maxlength="2000"
                                oninput="updateCharCount()"
                            ></textarea>
                            <div class="char-counter" id="char-counter">0 / 2000ì</div>
                        </div>
                    </div>

                    <div class="feedback-actions">
                        <div class="flex gap-3 justify-center">
                            <button class="btn btn-secondary" onclick="returnToSurvey()">
                                â† ì„¤ë¬¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                            </button>
                            <button class="btn btn-primary" onclick="submitFeedback()">
                                ì™„ë£Œí•˜ê¸°
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì™„ë£Œ í™”ë©´ -->
        <div id="completion-page" class="page">
            <div class="card">
                <div class="completion-container">
                    <div class="completion-message">
                        <h2>ë¡¯ë°í™ˆì‡¼í•‘ í˜œíƒ ë§¤ì¥ì˜ ì¹´ë“œ ë¶„ë¥˜í•˜ê¸° ë¦¬ì„œì¹˜ì— ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.</h2>
                        <p>ì‘ë‹µí•´ì£¼ì‹  ê²°ê³¼ëŠ” í˜œíƒ ë§¤ì¥ì˜ ë©”ë‰´ ê°œì„ ì— í¬ê²Œ ë„ì›€ì´ ë  ê±°ì˜ˆìš” : D</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒˆ ê·¸ë£¹ ìƒì„± ëª¨ë‹¬ -->
    <div id="create-group-modal" class="modal">
        <div class="modal-content">
            <h3>ìƒˆ ê·¸ë£¹ ë§Œë“¤ê¸°</h3>
            <div class="form-group">
                <label class="form-label">ê·¸ë£¹ ì´ë¦„</label>
                <input 
                    type="text" 
                    id="new-group-name" 
                    class="form-control" 
                    placeholder="ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                    maxlength="50"
                >
            </div>
            <div class="flex gap-2 justify-center">
                <button class="btn btn-secondary" onclick="closeModal('create-group-modal')">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="confirmCreateGroup()">ìƒì„±</button>
            </div>
        </div>
    </div>

    <!-- ì¹´ë“œ ë¶„ë¥˜í•˜ê¸° ë°©ë²• ê°€ì´ë“œ ëª¨ë‹¬ -->
    <div id="sorting-guide-modal" class="modal">
        <div class="modal-content">
            <h3>ğŸ“– ì¹´ë“œ ë¶„ë¥˜í•˜ê¸° ì•ˆë‚´ì„œ</h3>
            <div style="padding: 20px 0; line-height: 1.8;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin-bottom: 15px; font-size: 16px;"><strong>1.</strong> ì™¼ìª½ì˜ ëª¨ë“  ì¹´ë“œ ë‚´ìš©(ë©”ë‰´ í•­ëª©)ì„ ê¼¼ê¼¼í•˜ê²Œ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    
                    <p style="margin-bottom: 15px; font-size: 16px;"><strong>2.</strong> ì™¼ìª½ì˜ ì¹´ë“œë¥¼ í´ë¦­í•œ ìƒíƒœì—ì„œ ê´€ë ¨ì„±ì´ ë†’ë‹¤ê³  ìƒê°ë˜ëŠ” ì˜¤ë¥¸ìª½ ê·¸ë£¹ìœ¼ë¡œ ì˜®ê²¨ì£¼ì„¸ìš”.</p>
                    
                    <p style="margin-bottom: 15px; font-size: 16px;"><strong>3.</strong> ê·¸ë£¹ ì´ë¦„ì€ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ë„ ê´œì°®ê³ , ë³€ê²½ì„ ì›í•˜ì‹¤ ê²½ìš° ê·¸ë£¹ ì´ë¦„ì„ í´ë¦­í•´ ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ìˆ˜ì •í•´ ì£¼ì„¸ìš”.</p>
                    
                    <p style="margin-bottom: 15px; font-size: 16px;"><strong>4.</strong> ì–´ë–¤ ê·¸ë£¹ì—ë„ ì†í•˜ì§€ ì•ŠëŠ” ì¹´ë“œê°€ ìˆë‹¤ë©´, ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ 'ìƒˆ ê·¸ë£¹ ë§Œë“¤ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒˆë¡œìš´ ê·¸ë£¹ì„ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.</p>
                    
                    <p style="margin-bottom: 0; font-size: 16px;"><strong>5.</strong> ëª¨ë“  ì¹´ë“œê°€ ê·¸ë£¹ì— í¬í•¨ë˜ì—ˆëŠ”ì§€ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•œ í›„, 'ì‘ë‹µ ì œì¶œí•˜ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.</p>
                </div>
                
                <p style="color: #666; font-style: italic; text-align: center; margin-top: 20px;">
                    ì¹´ë“œ ë¶„ë¥˜í•˜ê¸°ë¥¼ ì§„í–‰í•˜ì‹œë‹¤ê°€ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹¤ ë•ŒëŠ” ì–¸ì œë“ ì§€ 'ì¹´ë“œ ë¶„ë¥˜í•˜ê¸° ì•ˆë‚´ì„œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                </p>
            </div>
            <div class="flex justify-center">
                <button class="btn btn-primary" onclick="closeModal('sorting-guide-modal')">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        // ê³µí†µ ê¸°ëŠ¥ + ì°¸ì—¬ì ì „ìš© ê¸°ëŠ¥
        
        // ============================================
        // ğŸ”— Google Sheets ì—°ë™ ì„¤ì •
        // ============================================
        
        let GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx3ridIkA9eP6YX0WrUgBItWJo_uRWDjvrUf6IqX95POh1JMqA2xlP7qXx5BFzYTUFNiQ/exec';
        let SPREADSHEET_ID = '1V9iTiBnesG9TRTHzohpAyC0358xzQVn2j9qQuVaj8FY';
        
        // ì°¸ì—¬ì ì „ìš© ìƒíƒœ ê´€ë¦¬
        let appState = {
            currentParticipant: null,
            currentProject: null,
            sortingData: null,
            startTime: null,
            surveyData: null
        };
        
        // ê¸°ë³¸ í”„ë¡œì íŠ¸ ì„¤ì •
        const DEFAULT_PROJECT = {
            id: 'default-project',
            title: 'í˜œíƒ ì½˜í…ì¸  ì¹´ë“œì†ŒíŒ…',
            cards: [
                'ë°©ì†¡ ì•Œë¦¼ ì‹ ì²­í•˜ê³  ì ë¦½ê¸ˆ ë°›ê¸°',
                'ë©¤ë²„ì‹­ ê°€ì…í•˜ê³  í• ì¸ ì¿ í° ë°›ê¸°', 
                'ë°©ì†¡ ì±„íŒ… ë‚¨ê¸°ê³  ì ë¦½ê¸ˆ ë°›ê¸°',
                'ì¹œêµ¬ ì¶”ì²œí•˜ê³  í¬ì¸íŠ¸ ë°›ê¸°',
                'ì²« êµ¬ë§¤ í›„ ìºì‹œë°± ë°›ê¸°',
                'ë¦¬ë·° ì‘ì„±í•˜ê³  ì ë¦½ê¸ˆ ë°›ê¸°',
                'ìƒì¼ ì¿ í° ë°›ê¸°',
                'ë“±ê¸‰ë³„ í• ì¸ í˜œíƒ',
                'ë¬´ë£Œë°°ì†¡ í˜œíƒ',
                'ì ë¦½ê¸ˆ í˜œíƒ'
            ],
            sortingType: 'hybrid',
            predefinedGroups: ['êµ¬ë§¤í˜œíƒ', 'ì°¸ì—¬í˜œíƒ', 'ì¹´ë“œ/ê²°ì œí˜œíƒ'],
            shuffleCards: true,
            allowEditGroups: true,
            createdAt: new Date().toISOString()
        };
        
        // ============================================
        // ğŸ”§ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        // ============================================
        
        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('ì €ì¥ ì‹¤íŒ¨:', error);
                return false;
            }
        }
        
        function loadFromStorage(key, defaultValue = null) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                return defaultValue;
            }
        }
        
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        }
        
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            const colors = {
                success: { bg: '#d4edda', border: '#28a745', text: '#155724' },
                warning: { bg: '#fff3cd', border: '#ffc107', text: '#856404' },
                error: { bg: '#f8d7da', border: '#dc3545', text: '#721c24' },
                info: { bg: '#d1ecf1', border: '#17a2b8', text: '#0c5460' }
            };
            
            const color = colors[type] || colors.info;
            notification.style.backgroundColor = color.bg;
            notification.style.borderColor = color.border;
            notification.style.color = color.text;
            
            notification.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; font-size: 20px; cursor: pointer; color: ${color.text}; margin-left: 15px;">Ã—</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // ============================================
        // ğŸ”— Google Sheets ì—°ë™ í•¨ìˆ˜ë“¤
        // ============================================
        
        async function saveToGoogleSheets(responseData, projectConfig) {
            return new Promise((resolve, reject) => {
                try {
                    console.log('ğŸ”— Google Sheets ì €ì¥ ì‹œì‘ (JSONP ë°©ì‹)...');
                    
                    const exportData = formatResponseForExport(responseData, projectConfig);
                    
                    const callbackName = 'jsonp_callback_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
                    
                    window[callbackName] = function(response) {
                        delete window[callbackName];
                        if (document.head.contains(script)) {
                            document.head.removeChild(script);
                        }
                        
                        console.log('ğŸ“Š Google Sheets ì‘ë‹µ:', response);
                        
                        if (response.status === 'success') {
                            showNotification('âœ… Google Sheetsì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                            resolve(response);
                        } else {
                            reject(new Error(response.message || 'ì €ì¥ ì‹¤íŒ¨'));
                        }
                    };
                    
                    const params = new URLSearchParams({
                        action: 'save',
                        data: JSON.stringify(exportData),
                        callback: callbackName
                    });
                    
                    const url = `${GOOGLE_APPS_SCRIPT_URL}?${params.toString()}`;
                    
                    const script = document.createElement('script');
                    script.src = url;
                    script.onerror = function() {
                        delete window[callbackName];
                        if (document.head.contains(script)) {
                            document.head.removeChild(script);
                        }
                        reject(new Error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨'));
                    };
                    
                    setTimeout(() => {
                        if (window[callbackName]) {
                            delete window[callbackName];
                            if (document.head.contains(script)) {
                                document.head.removeChild(script);
                            }
                            reject(new Error('íƒ€ì„ì•„ì›ƒ: ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'));
                        }
                    }, 15000);
                    
                    document.head.appendChild(script);
                    
                } catch (error) {
                    console.error('âŒ Google Sheets ì €ì¥ ì‹¤íŒ¨:', error);
                    reject(error);
                }
            });
        }
        
        function formatResponseForExport(responseData, projectConfig) {
            const groupResults = {};
            const cardDistribution = {};
            const groupOrder = [];
            
            const sortedGroups = Object.values(responseData.groups || {}).sort((a, b) => (a.order || 0) - (b.order || 0));
            
            sortedGroups.forEach(group => {
                if (group.cards.length > 0) {
                    groupResults[group.name] = group.cards.map(card => card.content);
                    groupOrder.push(group.name);
                    group.cards.forEach(card => {
                        cardDistribution[card.content] = group.name;
                    });
                }
            });
            
            if (responseData.unassignedCards && responseData.unassignedCards.length > 0) {
                groupResults['ë¯¸ë¶„ë¥˜'] = responseData.unassignedCards.map(card => card.content);
                responseData.unassignedCards.forEach(card => {
                    cardDistribution[card.content] = 'ë¯¸ë¶„ë¥˜';
                });
            }
            
            const customGroupsCount = Object.values(responseData.groups || {}).filter(g => g.isCustom && g.cards.length > 0).length;
            const usedGroupsCount = Object.keys(groupResults).length;
            const modifiedGroupNamesCount = responseData.modifiedGroupNames ? responseData.modifiedGroupNames.length : 0;
            
            const surveyResults = responseData.surveyData ? {
                mostUsed: responseData.surveyData.question1.map((card, index) => ({
                    rank: index + 1,
                    card: card.content,
                    group: cardDistribution[card.content] || 'ë¯¸ë¶„ë¥˜'
                })),
                leastUsed: responseData.surveyData.question2.map((card, index) => ({
                    rank: index + 1,
                    card: card.content,
                    group: cardDistribution[card.content] || 'ë¯¸ë¶„ë¥˜'
                }))
            } : null;
            
            return {
                ì´ë¦„: responseData.name || 'ì•Œ ìˆ˜ ì—†ìŒ',
                íœ´ëŒ€í°ë’·ë²ˆí˜¸4ìë¦¬: responseData.phone || '',
                ì‹œì‘ì‹œê°„: responseData.startTime,
                ì™„ë£Œì‹œê°„: responseData.completedTime,
                ì†Œìš”ì‹œê°„: Math.round(responseData.duration / 60) + 'ë¶„',
                ì†ŒíŒ…ë°©ì‹: responseData.sortingType,
                ì°¸ì—¬ìê°€ì¶”ê°€í•œê·¸ë£¹ìˆ˜: customGroupsCount,
                ì°¸ì—¬ìê°€ë¶„ë¥˜í•œê·¸ë£¹ìˆ˜: usedGroupsCount,
                ì°¸ì—¬ìê°€ë³€ê²½í•œê·¸ë£¹ëª…ì˜ìˆ˜: modifiedGroupNamesCount,
                ê·¸ë£¹ë³„ê²°ê³¼: JSON.stringify(groupResults),
                ê·¸ë£¹ìˆœì„œ: groupOrder.join(' > '),
                ê°€ì¥ë§ì´ì‚¬ìš©í•˜ëŠ”í˜œíƒ: responseData.surveyData ? responseData.surveyData.question1.map(c => c.content).join(', ') : '',
                ê°€ì¥ì ê²Œì‚¬ìš©í•˜ëŠ”í˜œíƒ: responseData.surveyData ? responseData.surveyData.question2.map(c => c.content).join(', ') : '',
                ì°¸ì—¬ìì˜ê²¬: responseData.participantFeedback || ''
            };
        }
        
        // ============================================
        // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤
        // ============================================
        
        function showWelcomePage() {
            showPage('welcome-page');
        }
        
        function showParticipantLogin() {
            showPage('participant-login-page');
        }
        
        function returnToLogin() {
            if (confirm('ì§„í–‰ ì¤‘ì¸ ì¹´ë“œì†ŒíŒ…ì´ ìˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì§„í–‰ ìƒí™©ì€ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.)')) {
                if (appState.sortingData) {
                    autoSave();
                }
                showParticipantLogin();
            }
        }
        
        function participantLogin(event) {
            event.preventDefault();
            const name = document.getElementById('participant-name').value.trim();
            const phone = document.getElementById('participant-phone').value.trim();
            
            if (!name || !phone) {
                showNotification('ì´ë¦„ê³¼ íœ´ëŒ€í° ë’·ë²ˆí˜¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
        
            if (!/^[ê°€-í£]+$/.test(name)) {
                showNotification('ì´ë¦„ì€ í•œê¸€ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
        
            if (!/^[0-9]{4}$/.test(phone)) {
                showNotification('íœ´ëŒ€í° ë’·ë²ˆí˜¸ëŠ” ìˆ«ì 4ìë¦¬ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
        
            const participantId = `${name}_${phone}`;
            const existingData = loadFromStorage(`participant_${participantId}`);
            
            if (existingData && !existingData.isCompleted) {
                appState.currentParticipant = { name, phone, id: participantId };
                document.getElementById('existing-response-notice').classList.remove('hidden');
                return;
            }
        
            startNewSorting(name, phone, participantId);
        }
        
        function continueExisting() {
            const { name, phone, id } = appState.currentParticipant;
            const existingData = loadFromStorage(`participant_${id}`);
            appState.sortingData = existingData;
            appState.startTime = new Date(existingData.startTime);
            startSortingPage();
        }
        
        function startNew() {
            const { name, phone, id } = appState.currentParticipant;
            startNewSorting(name, phone, id);
        }
        
        function startNewSorting(name, phone, participantId) {
            const project = loadFromStorage('current_project', DEFAULT_PROJECT);
            appState.currentParticipant = { name, phone, id: participantId };
            appState.currentProject = project;
            appState.startTime = new Date();
            
            let cards = [...project.cards];
            if (project.shuffleCards) {
                cards = shuffleArray(cards);
            }
            
            appState.sortingData = {
                participantId,
                name,
                phone,
                startTime: appState.startTime.toISOString(),
                lastSaveTime: appState.startTime.toISOString(),
                completedTime: null,
                duration: 0,
                isCompleted: false,
                sortingType: project.sortingType,
                groups: initializeGroups(project),
                unassignedCards: cards.map((card, index) => ({
                    id: `card-${index}`,
                    content: card,
                    originalIndex: index
                })),
                modifiedGroupNames: []
            };
        
            startSortingPage();
        }
        
        function initializeGroups(project) {
            const groups = {};
            if (project.sortingType !== 'open') {
                project.predefinedGroups.forEach((groupName, index) => {
                    groups[`group-${index}`] = {
                        id: `group-${index}`,
                        name: groupName,
                        originalName: groupName,
                        isCustom: false,
                        cards: [],
                        order: index
                    };
                });
            }
            return groups;
        }
        
        function startSortingPage() {
            showPage('sorting-page');
            const { name } = appState.currentParticipant;
            const { sortingType } = appState.currentProject;
            
            document.getElementById('sorting-participant-name').textContent = `${name}ë‹˜ì˜ ì¹´ë“œì†ŒíŒ…`;
            document.getElementById('sorting-type-info').textContent = getSortingTypeText(sortingType);
            
            const createGroupBtn = document.getElementById('create-group-btn');
            if (sortingType === 'closed') {
                createGroupBtn.style.display = 'none';
            } else {
                createGroupBtn.style.display = 'block';
            }
            
            renderSortingUI();
            updateProgress();
            
            if (!sessionStorage.getItem('guide_shown')) {
                showSortingGuide();
                sessionStorage.setItem('guide_shown', 'true');
            }
        }
        
        function getSortingTypeText(type) {
            switch (type) {
                case 'open': return 'ì˜¤í”ˆ ì†ŒíŒ… (ê·¸ë£¹ ììœ  ìƒì„±)';
                case 'closed': return 'í´ë¡œì¦ˆë“œ ì†ŒíŒ… (ê³ ì • ê·¸ë£¹)';
                case 'hybrid': return 'í•˜ì´ë¸Œë¦¬ë“œ ì†ŒíŒ… (ê¸°ë³¸ + ì‚¬ìš©ì ìƒì„±)';
                default: return 'ì¹´ë“œì†ŒíŒ… ì§„í–‰ ì¤‘';
            }
        }
        
        // ============================================
        // ì¹´ë“œ ì†ŒíŒ… UI ë Œë”ë§ í•¨ìˆ˜ë“¤
        // ============================================
        
        function renderSortingUI() {
            renderCardPool();
            renderGroups();
        }
        
        function renderCardPool() {
            const cardPool = document.getElementById('card-pool');
            const cardPoolContainer = cardPool.parentElement;
            const { unassignedCards } = appState.sortingData;
            cardPool.innerHTML = '';
            
            if (!cardPoolContainer.hasAttribute('data-drop-enabled')) {
                cardPoolContainer.addEventListener('dragover', handleDragOver);
                cardPoolContainer.addEventListener('drop', handleDropToPool);
                cardPoolContainer.addEventListener('dragenter', handleDragEnterPool);
                cardPoolContainer.addEventListener('dragleave', handleDragLeavePool);
                cardPoolContainer.setAttribute('data-drop-enabled', 'true');
            }
            
            unassignedCards.forEach(card => {
                const cardElement = createCardElement(card);
                cardPool.appendChild(cardElement);
            });
            
            document.getElementById('unassigned-count').textContent = unassignedCards.length;
        }
        
        function createCardElement(card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card-item';
            cardDiv.textContent = card.content;
            cardDiv.draggable = true;
            cardDiv.dataset.cardId = card.id;
            
            cardDiv.addEventListener('dragstart', handleDragStart);
            cardDiv.addEventListener('dragend', handleDragEnd);
            
            return cardDiv;
        }
        
        function renderGroups() {
            const container = document.getElementById('groups-container');
            const { groups } = appState.sortingData;
            container.innerHTML = '';
            
            const sortedGroups = Object.values(groups).sort((a, b) => (a.order || 0) - (b.order || 0));
            
            sortedGroups.forEach((group, index) => {
                const groupElement = createGroupElement(group, index + 1);
                container.appendChild(groupElement);
            });
            
            if (!container.hasAttribute('data-group-sort-enabled')) {
                container.addEventListener('dragover', handleGroupDragOver);
                container.addEventListener('drop', handleGroupDrop);
                container.setAttribute('data-group-sort-enabled', 'true');
            }
        }
        
        function createGroupElement(group, rank) {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'group-container';
            groupDiv.dataset.groupId = group.id;
            groupDiv.draggable = true;
            
            groupDiv.addEventListener('dragover', handleDragOver);
            groupDiv.addEventListener('drop', handleDrop);
            groupDiv.addEventListener('dragenter', handleDragEnter);
            groupDiv.addEventListener('dragleave', handleDragLeave);
            groupDiv.addEventListener('dragstart', handleGroupDragStart);
            groupDiv.addEventListener('dragend', handleGroupDragEnd);
            
            const dragHandle = document.createElement('div');
            dragHandle.className = 'group-drag-handle';
            dragHandle.innerHTML = 'â‹®â‹®';
            dragHandle.title = 'ê·¸ë£¹ ìˆœì„œ ë³€ê²½ (ë“œë˜ê·¸)';
            groupDiv.appendChild(dragHandle);
            
            const metaInfo = document.createElement('div');
            metaInfo.className = 'group-meta-info';
            
            const rankDiv = document.createElement('div');
            rankDiv.className = 'group-rank';
            rankDiv.textContent = `ê·¸ë£¹${rank}`;
            metaInfo.appendChild(rankDiv);
            
            const cardCountDiv = document.createElement('div');
            cardCountDiv.className = 'group-card-count';
            cardCountDiv.textContent = `ì¹´ë“œ ìˆ˜: ${group.cards.length}ê°œ`;
            metaInfo.appendChild(cardCountDiv);
            
            groupDiv.appendChild(metaInfo);
            
            const header = document.createElement('div');
            header.className = 'group-header';
            
            const title = document.createElement('div');
            title.className = 'group-title editable';
            title.textContent = group.name;
            
            const allowEdit = appState.currentProject.allowEditGroups;
            if (allowEdit || group.isCustom) {
                title.addEventListener('click', () => editGroupName(group.id));
            }
            
            const actions = document.createElement('div');
            actions.className = 'group-actions';
            
            if (group.isCustom) {
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-group-btn';
                deleteBtn.textContent = 'Ã—';
                deleteBtn.onclick = () => deleteGroup(group.id);
                actions.appendChild(deleteBtn);
            }
            
            header.appendChild(title);
            header.appendChild(actions);
            
            const content = document.createElement('div');
            content.className = 'group-content';
            
            if (group.cards.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'empty-group';
                empty.textContent = 'ì¹´ë“œë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”';
                content.appendChild(empty);
            } else {
                group.cards.forEach(card => {
                    const cardElement = createCardElement(card);
                    content.appendChild(cardElement);
                });
            }
            
            groupDiv.appendChild(header);
            groupDiv.appendChild(content);
            
            return groupDiv;
        }
        
        // ============================================
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤
        // ============================================
        
        function handleDragStart(event) {
            if (!event.target.classList.contains('card-item')) return;
            
            const cardId = event.target.dataset.cardId;
            event.dataTransfer.setData('text/plain', cardId);
            event.dataTransfer.setData('text/drag-type', 'card');
            event.target.classList.add('dragging');
        }
        
        function handleDragEnd(event) {
            event.target.classList.remove('dragging');
            document.querySelectorAll('.group-container').forEach(group => {
                group.classList.remove('drag-over');
            });
            document.querySelectorAll('.card-pool').forEach(pool => {
                pool.classList.remove('drag-over');
            });
        }
        
        function handleDragOver(event) {
            event.preventDefault();
        }
        
        function handleDragEnter(event) {
            const targetGroup = event.target.closest('.group-container');
            if (targetGroup) {
                targetGroup.classList.add('drag-over');
            }
        }
        
        function handleDragLeave(event) {
            const targetGroup = event.target.closest('.group-container');
            if (targetGroup && !targetGroup.contains(event.relatedTarget)) {
                targetGroup.classList.remove('drag-over');
            }
        }
        
        function handleDrop(event) {
            event.preventDefault();
            
            const dragType = event.dataTransfer.getData('text/drag-type');
            
            if (dragType === 'card') {
                const cardId = event.dataTransfer.getData('text/plain');
                const targetGroup = event.target.closest('.group-container');
                const targetGroupId = targetGroup.dataset.groupId;
                moveCardToGroup(cardId, targetGroupId);
                targetGroup.classList.remove('drag-over');
            }
        }
        
        function handleDragEnterPool(event) {
            event.target.closest('.card-pool').classList.add('drag-over');
        }
        
        function handleDragLeavePool(event) {
            if (!event.target.closest('.card-pool').contains(event.relatedTarget)) {
                event.target.closest('.card-pool').classList.remove('drag-over');
            }
        }
        
        function handleDropToPool(event) {
            event.preventDefault();
            const cardId = event.dataTransfer.getData('text/plain');
            const cardPool = event.target.closest('.card-pool');
            moveCardToPool(cardId);
            cardPool.classList.remove('drag-over');
        }
        
        function handleGroupDragStart(event) {
            if (!event.target.classList.contains('group-container')) return;
            
            const groupId = event.target.dataset.groupId;
            event.dataTransfer.setData('text/group-id', groupId);
            event.dataTransfer.setData('text/drag-type', 'group');
            event.target.classList.add('dragging-group');
        }
        
        function handleGroupDragEnd(event) {
            event.target.classList.remove('dragging-group');
            document.querySelectorAll('.group-container').forEach(group => {
                group.classList.remove('drag-over');
            });
        }
        
        function handleGroupDragOver(event) {
            event.preventDefault();
            const targetGroup = event.target.closest('.group-container');
            if (targetGroup && !targetGroup.classList.contains('dragging-group')) {
                targetGroup.classList.add('drag-over');
            }
        }
        
        function handleGroupDrop(event) {
            event.preventDefault();
            
            const dragType = event.dataTransfer.getData('text/drag-type');
            if (dragType === 'group') {
                const draggedGroupId = event.dataTransfer.getData('text/group-id');
                const targetGroup = event.target.closest('.group-container');
                
                if (targetGroup && targetGroup.dataset.groupId !== draggedGroupId) {
                    const targetGroupId = targetGroup.dataset.groupId;
                    reorderGroups(draggedGroupId, targetGroupId);
                }
                
                targetGroup.classList.remove('drag-over');
            } else {
                const cardId = event.dataTransfer.getData('text/plain');
                const targetGroup = event.target.closest('.group-container');
                const targetGroupId = targetGroup.dataset.groupId;
                moveCardToGroup(cardId, targetGroupId);
                targetGroup.classList.remove('drag-over');
            }
        }
        
        function moveCardToPool(cardId) {
            const { groups, unassignedCards } = appState.sortingData;
            let card = null;
            
            const alreadyUnassigned = unassignedCards.find(c => c.id === cardId);
            if (alreadyUnassigned) return;
            
            for (const group of Object.values(groups)) {
                const cardIndex = group.cards.findIndex(c => c.id === cardId);
                if (cardIndex !== -1) {
                    card = group.cards.splice(cardIndex, 1)[0];
                    break;
                }
            }
            
            if (card) {
                unassignedCards.push(card);
                renderSortingUI();
                updateProgress();
                autoSave();
            }
        }
        
        function moveCardToGroup(cardId, targetGroupId) {
            const { groups, unassignedCards } = appState.sortingData;
            let card = null;
            
            const unassignedIndex = unassignedCards.findIndex(c => c.id === cardId);
            if (unassignedIndex !== -1) {
                card = unassignedCards.splice(unassignedIndex, 1)[0];
            } else {
                for (const group of Object.values(groups)) {
                    const cardIndex = group.cards.findIndex(c => c.id === cardId);
                    if (cardIndex !== -1) {
                        card = group.cards.splice(cardIndex, 1)[0];
                        break;
                    }
                }
            }
            
            if (card && groups[targetGroupId]) {
                groups[targetGroupId].cards.push(card);
                renderSortingUI();
                updateProgress();
                autoSave();
            }
        }
        
        function reorderGroups(draggedGroupId, targetGroupId) {
            const { groups } = appState.sortingData;
            const draggedGroup = groups[draggedGroupId];
            const targetGroup = groups[targetGroupId];
            
            if (!draggedGroup || !targetGroup) return;
            
            const draggedOrder = draggedGroup.order || 0;
            const targetOrder = targetGroup.order || 0;
            
            draggedGroup.order = targetOrder;
            targetGroup.order = draggedOrder;
            
            renderGroups();
            autoSave();
            
            showNotification('âœ… ê·¸ë£¹ ìˆœì„œê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
        
        function createNewGroup() {
            showModal('create-group-modal');
            document.getElementById('new-group-name').focus();
        }
        
        function showSortingGuide() {
            showModal('sorting-guide-modal');
        }
        
        function confirmCreateGroup() {
            const groupName = document.getElementById('new-group-name').value.trim();
            
            if (!groupName) {
                showNotification('ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            if (groupName.length > 50) {
                showNotification('ê·¸ë£¹ ì´ë¦„ì€ 50ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            const existingNames = Object.values(appState.sortingData.groups).map(g => g.name);
            if (existingNames.includes(groupName)) {
                showNotification('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê·¸ë£¹ ì´ë¦„ì…ë‹ˆë‹¤.', 'warning');
                return;
            }
            
            const maxOrder = Object.values(appState.sortingData.groups).reduce((max, group) => {
                return Math.max(max, group.order || 0);
            }, -1);
            
            const newGroupId = `custom-${generateId()}`;
            appState.sortingData.groups[newGroupId] = {
                id: newGroupId,
                name: groupName,
                originalName: groupName,
                isCustom: true,
                cards: [],
                order: maxOrder + 1
            };
            
            renderGroups();
            closeModal('create-group-modal');
            document.getElementById('new-group-name').value = '';
            autoSave();
        }
        
        function editGroupName(groupId) {
            const group = appState.sortingData.groups[groupId];
            if (!group) return;
            
            const allowEdit = appState.currentProject.allowEditGroups;
            if (!allowEdit && !group.isCustom) return;
            
            const newName = prompt('ìƒˆ ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', group.name);
            if (newName && newName.trim() && newName.trim() !== group.name) {
                if (!group.isCustom && group.originalName !== newName.trim()) {
                    if (!appState.sortingData.modifiedGroupNames.includes(group.originalName)) {
                        appState.sortingData.modifiedGroupNames.push(group.originalName);
                    }
                }
                
                group.name = newName.trim();
                renderGroups();
                autoSave();
            }
        }
        
        function deleteGroup(groupId) {
            const group = appState.sortingData.groups[groupId];
            if (!group || !group.isCustom) return;
            
            if (confirm(`'${group.name}' ê·¸ë£¹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? í¬í•¨ëœ ì¹´ë“œë“¤ì€ ë¯¸ë¶„ë¥˜ë¡œ ì´ë™í•©ë‹ˆë‹¤.`)) {
                appState.sortingData.unassignedCards.push(...group.cards);
                delete appState.sortingData.groups[groupId];
                renderSortingUI();
                updateProgress();
                autoSave();
            }
        }
        
        function updateProgress() {
            if (!appState.sortingData) return;
            
            const totalCards = appState.currentProject.cards.length;
            const assignedCards = totalCards - appState.sortingData.unassignedCards.length;
            const progress = Math.round((assignedCards / totalCards) * 100);
            
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = 
                `${totalCards}ê°œ ì¤‘ ${assignedCards}ê°œ ì¹´ë“œ ë¶„ë¥˜ ì™„ë£Œ (${progress}%)`;
            
            const submitBtn = document.getElementById('submit-btn');
            if (assignedCards === totalCards) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'âœ… ì‘ë‹µ ì œì¶œí•˜ê¸°';
                submitBtn.style.opacity = '1';
            } else {
                submitBtn.disabled = false;
                submitBtn.textContent = `âœ… ì‘ë‹µ ì œì¶œí•˜ê¸° (${totalCards - assignedCards}ê°œ ë¯¸ë¶„ë¥˜)`;
                submitBtn.style.opacity = '0.8';
            }
        }
        
        function autoSave() {
            if (!appState.sortingData) return;
            appState.sortingData.lastSaveTime = new Date().toISOString();
            saveToStorage(`participant_${appState.sortingData.participantId}`, appState.sortingData);
        }
        
        function resetAllCards() {
            if (!confirm('ëª¨ë“  ì¹´ë“œë¥¼ ë¯¸ë¶„ë¥˜ ìƒíƒœë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const { groups } = appState.sortingData;
            Object.values(groups).forEach(group => {
                appState.sortingData.unassignedCards.push(...group.cards);
                group.cards = [];
            });
            
            renderSortingUI();
            updateProgress();
            autoSave();
        }
        
        function submitSorting() {
            if (!appState.sortingData) return;
            
            const unassignedCount = appState.sortingData.unassignedCards.length;
            
            if (unassignedCount > 0) {
                alert(`ì•„ì§ ${unassignedCount}ê°œì˜ ì¹´ë“œê°€ ë¶„ë¥˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nëª¨ë“  ì¹´ë“œë¥¼ ê·¸ë£¹ìœ¼ë¡œ ì´ë™í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            appState.sortingData.sortingCompletedTime = new Date().toISOString();
            appState.sortingData.sortingDuration = Math.floor((new Date() - appState.startTime) / 1000);
            
            autoSave();
            
            showSurveyPage();
        }
        
        // ============================================
        // ì„¤ë¬¸ í˜ì´ì§€ ê´€ë ¨ í•¨ìˆ˜ë“¤
        // ============================================
        
        function showSurveyPage() {
            showPage('survey-page');
            
            if (appState.sortingData.tempSurveyData) {
                appState.surveyData = appState.sortingData.tempSurveyData;
            } else {
                appState.surveyData = {
                    question1: [],
                    question2: []
                };
            }
            
            setupSurveyDropZones();
            renderSurveyCenterCards();
            restoreSurveySelections();
            updateSurveyProgressInfo();
        }
        
        function setupSurveyDropZones() {
            const q1DropZone = document.getElementById('q1-drop-zone');
            const q2DropZone = document.getElementById('q2-drop-zone');
            
            [q1DropZone, q2DropZone].forEach(zone => {
                zone.addEventListener('dragover', handleSurveyDragOver);
                zone.addEventListener('drop', handleSurveyDrop);
                zone.addEventListener('dragenter', handleSurveyDragEnter);
                zone.addEventListener('dragleave', handleSurveyDragLeave);
            });
        }
        
        function renderSurveyCenterCards() {
            const container = document.getElementById('survey-center-groups');
            container.innerHTML = '';
            
            const { groups } = appState.sortingData;
            const sortedGroups = Object.values(groups)
                .filter(group => group.cards.length > 0)
                .sort((a, b) => (a.order || 0) - (b.order || 0));
            
            sortedGroups.forEach(group => {
                const groupSection = createSurveyGroupSection(group);
                container.appendChild(groupSection);
            });
        }
        
        function createSurveyGroupSection(group) {
            const section = document.createElement('div');
            section.className = 'survey-group-section';
            section.style.cssText = 'background: white; border-radius: 8px; margin-bottom: 15px; overflow: hidden; border: 1px solid #dee2e6;';
            
            const header = document.createElement('div');
            header.className = 'survey-group-header';
            header.style.cssText = 'background: #667eea; color: white; padding: 12px 15px; font-weight: 600; font-size: 14px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;';
            header.onclick = () => toggleSurveyGroup(section);
            
            const title = document.createElement('span');
            title.textContent = `${group.name} (${group.cards.length}ê°œ)`;
            
            const toggle = document.createElement('span');
            toggle.className = 'survey-group-toggle';
            toggle.style.cssText = 'font-size: 16px; transition: transform 0.3s;';
            toggle.textContent = 'â–¼';
            
            header.appendChild(title);
            header.appendChild(toggle);
            
            const cardsContainer = document.createElement('div');
            cardsContainer.className = 'survey-group-cards';
            cardsContainer.style.cssText = 'padding: 15px; display: block;';
            
            group.cards.forEach(card => {
                const isInQ1 = appState.surveyData.question1.some(c => c.id === card.id);
                const isInQ2 = appState.surveyData.question2.some(c => c.id === card.id);
                
                if (!isInQ1 && !isInQ2) {
                    const cardElement = createSurveyDraggableCard(card);
                    cardsContainer.appendChild(cardElement);
                }
            });
            
            section.appendChild(header);
            section.appendChild(cardsContainer);
            
            return section;
        }
        
        function createSurveyDraggableCard(card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'survey-draggable-card';
            cardDiv.style.cssText = 'background: white; border: 2px solid #dee2e6; border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: move; position: relative; transition: all 0.2s; font-size: 14px; user-select: none;';
            cardDiv.textContent = card.content;
            cardDiv.draggable = true;
            cardDiv.dataset.cardId = card.id;
            cardDiv.dataset.cardContent = card.content;
            
            cardDiv.addEventListener('dragstart', handleSurveyCardDragStart);
            cardDiv.addEventListener('dragend', handleSurveyCardDragEnd);
            
            return cardDiv;
        }
        
        function createSurveyDroppedCard(card, questionNum) {
            const cardDiv = document.createElement('div');
            cardDiv.className = `survey-dropped-card q${questionNum}`;
            cardDiv.textContent = card.content;
            cardDiv.draggable = true;
            cardDiv.dataset.cardId = card.id;
            cardDiv.dataset.cardContent = card.content;
            cardDiv.dataset.questionNum = questionNum;
            
            const styles = {
                1: 'border-color: #2196f3; background: #e3f2fd; color: #1976d2;',
                2: 'border-color: #f44336; background: #ffebee; color: #d32f2f;'
            };
            
            cardDiv.style.cssText = `background: white; border: 2px solid #dee2e6; border-radius: 8px; padding: 12px; margin-bottom: 10px; cursor: move; position: relative; transition: all 0.2s; font-size: 14px; ${styles[questionNum]}`;
            
            const rankDiv = document.createElement('div');
            rankDiv.className = `survey-card-rank q${questionNum}`;
            rankDiv.style.cssText = `position: absolute; top: -8px; left: -8px; width: 24px; height: 24px; border-radius: 50%; background: white; border: 2px solid; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; border-color: ${questionNum === 1 ? '#2196f3' : '#f44336'}; color: ${questionNum === 1 ? '#2196f3' : '#f44336'};`;
            cardDiv.appendChild(rankDiv);
            
            cardDiv.addEventListener('dragstart', handleSurveyDroppedCardDragStart);
            cardDiv.addEventListener('dragend', handleSurveyCardDragEnd);
            
            return cardDiv;
        }
        
        function toggleSurveyGroup(section) {
            const cardsContainer = section.querySelector('.survey-group-cards');
            const toggle = section.querySelector('.survey-group-toggle');
            
            if (cardsContainer.style.display === 'none') {
                cardsContainer.style.display = 'block';
                toggle.style.transform = 'rotate(0deg)';
                toggle.textContent = 'â–¼';
            } else {
                cardsContainer.style.display = 'none';
                toggle.style.transform = 'rotate(-90deg)';
                toggle.textContent = 'â–¶';
            }
        }
        
        function handleSurveyCardDragStart(event) {
            const cardId = event.target.dataset.cardId;
            const cardContent = event.target.dataset.cardContent;
            
            event.dataTransfer.setData('text/card-id', cardId);
            event.dataTransfer.setData('text/card-content', cardContent);
            event.dataTransfer.setData('text/drag-source', 'center');
            
            event.target.classList.add('dragging');
        }
        
        function handleSurveyDroppedCardDragStart(event) {
            const cardId = event.target.dataset.cardId;
            const cardContent = event.target.dataset.cardContent;
            const questionNum = event.target.dataset.questionNum;
            
            event.dataTransfer.setData('text/card-id', cardId);
            event.dataTransfer.setData('text/card-content', cardContent);
            event.dataTransfer.setData('text/drag-source', `question${questionNum}`);
            
            event.target.classList.add('dragging');
        }
        
        function handleSurveyCardDragEnd(event) {
            event.target.classList.remove('dragging');
            document.querySelectorAll('.survey-drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
        }
        
        function handleSurveyDragOver(event) {
            event.preventDefault();
        }
        
        function handleSurveyDragEnter(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }
        
        function handleSurveyDragLeave(event) {
            if (!event.currentTarget.contains(event.relatedTarget)) {
                event.currentTarget.classList.remove('drag-over');
            }
        }
        
        function handleSurveyDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const cardId = event.dataTransfer.getData('text/card-id');
            const cardContent = event.dataTransfer.getData('text/card-content');
            const dragSource = event.dataTransfer.getData('text/drag-source');
            
            const dropZone = event.currentTarget;
            let targetQuestion = 0;
            
            if (dropZone.id === 'q1-drop-zone') {
                targetQuestion = 1;
            } else if (dropZone.id === 'q2-drop-zone') {
                targetQuestion = 2;
            }
            
            if (targetQuestion === 0) return;
            
            const card = findCardById(cardId);
            if (!card) return;
            
            removeCardFromSelections(cardId);
            
            const targetArray = targetQuestion === 1 ? appState.surveyData.question1 : appState.surveyData.question2;
            
            if (targetArray.length >= 3) {
                showNotification(`ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'warning');
                return;
            }
            
            targetArray.push(card);
            
            updateSurveyDropZones();
            renderSurveyCenterCards();
            updateSurveyProgressInfo();
        }
        
        function findCardById(cardId) {
            const { groups } = appState.sortingData;
            
            for (const group of Object.values(groups)) {
                const card = group.cards.find(c => c.id === cardId);
                if (card) return card;
            }
            
            return null;
        }
        
        function removeCardFromSelections(cardId) {
            const q1Index = appState.surveyData.question1.findIndex(c => c.id === cardId);
            if (q1Index !== -1) {
                appState.surveyData.question1.splice(q1Index, 1);
            }
            
            const q2Index = appState.surveyData.question2.findIndex(c => c.id === cardId);
            if (q2Index !== -1) {
                appState.surveyData.question2.splice(q2Index, 1);
            }
        }
        
        function updateSurveyDropZones() {
            const q1Container = document.getElementById('q1-cards');
            q1Container.innerHTML = '';
            
            if (appState.surveyData.question1.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #adb5bd; font-style: italic; text-align: center; pointer-events: none;';
                emptyDiv.textContent = 'ì¹´ë“œë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”';
                q1Container.appendChild(emptyDiv);
            } else {
                appState.surveyData.question1.forEach((card, index) => {
                    const cardElement = createSurveyDroppedCard(card, 1);
                    const rankDiv = cardElement.querySelector('.survey-card-rank');
                    rankDiv.textContent = index + 1;
                    q1Container.appendChild(cardElement);
                });
            }
            
            const q2Container = document.getElementById('q2-cards');
            q2Container.innerHTML = '';
            
            if (appState.surveyData.question2.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #adb5bd; font-style: italic; text-align: center; pointer-events: none;';
                emptyDiv.textContent = 'ì¹´ë“œë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”';
                q2Container.appendChild(emptyDiv);
            } else {
                appState.surveyData.question2.forEach((card, index) => {
                    const cardElement = createSurveyDroppedCard(card, 2);
                    const rankDiv = cardElement.querySelector('.survey-card-rank');
                    rankDiv.textContent = index + 1;
                    q2Container.appendChild(cardElement);
                });
            }
        }
        
        function updateSurveyProgressInfo() {
            const q1Progress = document.getElementById('q1-progress-display');
            const q2Progress = document.getElementById('q2-progress-display');
            
            const q1Count = appState.surveyData.question1.length;
            const q2Count = appState.surveyData.question2.length;
            
            q1Progress.textContent = `${q1Count}/3ê°œ`;
            q2Progress.textContent = `${q2Count}/3ê°œ`;
            
            const q1DropZone = document.getElementById('q1-drop-zone');
            const q2DropZone = document.getElementById('q2-drop-zone');
            
            if (q1Count === 3) {
                q1DropZone.querySelector('.drop-zone-header').style.background = '#e8f5e9';
                q1DropZone.querySelector('.drop-zone-header').style.borderColor = '#4caf50';
                q1DropZone.querySelector('.drop-zone-header').style.color = '#388e3c';
            } else {
                q1DropZone.querySelector('.drop-zone-header').style.background = '#e3f2fd';
                q1DropZone.querySelector('.drop-zone-header').style.borderColor = '#2196f3';
                q1DropZone.querySelector('.drop-zone-header').style.color = '#1976d2';
            }
            
            if (q2Count === 3) {
                q2DropZone.querySelector('.drop-zone-header').style.background = '#e8f5e9';
                q2DropZone.querySelector('.drop-zone-header').style.borderColor = '#4caf50';
                q2DropZone.querySelector('.drop-zone-header').style.color = '#388e3c';
            } else {
                q2DropZone.querySelector('.drop-zone-header').style.background = '#ffebee';
                q2DropZone.querySelector('.drop-zone-header').style.borderColor = '#f44336';
                q2DropZone.querySelector('.drop-zone-header').style.color = '#d32f2f';
            }
            
            const submitBtn = document.getElementById('survey-submit-btn');
            submitBtn.disabled = false;
        }
        
        function restoreSurveySelections() {
            updateSurveyDropZones();
        }
        
        function returnToSorting() {
            if (appState.surveyData) {
                appState.sortingData.tempSurveyData = appState.surveyData;
                autoSave();
            }
            
            showPage('sorting-page');
            renderSortingUI();
            updateProgress();
        }
        
        async function submitSurvey() {
            if (!appState.sortingData || !appState.surveyData) return;
            
            const q1Count = appState.surveyData.question1.length;
            const q2Count = appState.surveyData.question2.length;
            
            if (q1Count !== 3 || q2Count !== 3) {
                let message = 'ì„ íƒì„ ì™„ë£Œí•´ì£¼ì„¸ìš”:\n';
                if (q1Count !== 3) {
                    message += `â€¢ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” í˜œíƒ: ${q1Count}/3ê°œ ì„ íƒë¨\n`;
                }
                if (q2Count !== 3) {
                    message += `â€¢ ê°€ì¥ ì ê²Œ ì‚¬ìš©í•˜ëŠ” í˜œíƒ: ${q2Count}/3ê°œ ì„ íƒë¨`;
                }
                
                alert(message);
                return;
            }
            
            appState.sortingData.surveyData = appState.surveyData;
            delete appState.sortingData.tempSurveyData;
            
            autoSave();
            
            showFeedbackPage();
        }
        
        // ============================================
        // ì˜ê²¬ ìˆ˜ì§‘ í˜ì´ì§€ ê´€ë ¨ í•¨ìˆ˜ë“¤
        // ============================================
        
        function showFeedbackPage() {
            showPage('feedback-page');
            
            displaySortingResults();
            
            if (appState.sortingData.tempFeedback) {
                document.getElementById('participant-feedback').value = appState.sortingData.tempFeedback;
                updateCharCount();
            }
        }
        
        function displaySortingResults() {
            const container = document.getElementById('sorting-result-display');
            const { groups } = appState.sortingData;
            container.innerHTML = '';
            container.style.cssText = 'max-height: 380px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: 8px; flex: 1;';
            
            const sortedGroups = Object.values(groups)
                .filter(group => group.cards.length > 0)
                .sort((a, b) => (a.order || 0) - (b.order || 0));
            
            sortedGroups.forEach((group, index) => {
                const resultGroup = document.createElement('div');
                resultGroup.style.cssText = 'background: white; margin-bottom: 15px; border-radius: 8px; overflow: hidden; border: 1px solid #dee2e6;';
                
                const header = document.createElement('div');
                header.style.cssText = 'background: #667eea; color: white; padding: 10px 15px; font-weight: 600; font-size: 14px;';
                header.textContent = `ê·¸ë£¹${index + 1}: ${group.name} (${group.cards.length}ê°œ)`;
                
                const cardsContainer = document.createElement('div');
                cardsContainer.style.cssText = 'padding: 10px 15px;';
                
                group.cards.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.style.cssText = 'background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 6px; font-size: 13px; border-left: 3px solid #667eea;';
                    cardElement.textContent = card.content;
                    cardsContainer.appendChild(cardElement);
                });
                
                resultGroup.appendChild(header);
                resultGroup.appendChild(cardsContainer);
                container.appendChild(resultGroup);
            });
        }
        
        function updateCharCount() {
            const textarea = document.getElementById('participant-feedback');
            const counter = document.getElementById('char-counter');
            const currentLength = textarea.value.length;
            const maxLength = 2000;
            
            counter.textContent = `${currentLength} / ${maxLength}ì`;
            
            if (currentLength > maxLength * 0.9) {
                counter.className = 'char-counter danger';
            } else if (currentLength > maxLength * 0.7) {
                counter.className = 'char-counter warning';
            } else {
                counter.className = 'char-counter';
            }
        }
        
        function returnToSurvey() {
            const feedback = document.getElementById('participant-feedback').value.trim();
            if (feedback) {
                appState.sortingData.tempFeedback = feedback;
                autoSave();
            }
            
            showSurveyPage();
        }
        
        async function submitFeedback() {
            if (!appState.sortingData || !appState.surveyData) return;
            
            try {
                const feedback = document.getElementById('participant-feedback').value.trim();
                
                appState.sortingData.isCompleted = true;
                appState.sortingData.completedTime = new Date().toISOString();
                appState.sortingData.duration = Math.floor((new Date() - appState.startTime) / 1000);
                appState.sortingData.surveyData = appState.surveyData;
                appState.sortingData.participantFeedback = feedback;
                
                delete appState.sortingData.tempSurveyData;
                delete appState.sortingData.tempFeedback;
                
                saveToStorage(`participant_${appState.sortingData.participantId}`, appState.sortingData);
                
                try {
                    await saveToGoogleSheets(appState.sortingData, appState.currentProject);
                } catch (error) {
                    console.warn('Google Sheets ì €ì¥ ì‹¤íŒ¨, ë¡œì»¬ ì €ì¥ì€ ì™„ë£Œë¨:', error);
                    showNotification('âš ï¸ Google Sheets ì €ì¥ ì‹¤íŒ¨. ë¡œì»¬ ì €ì¥ì€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
                }
                
                showCompletionPage();
                
            } catch (error) {
                console.error('ì œì¶œ ì¤‘ ì˜¤ë¥˜:', error);
                showNotification('ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            }
        }
        
        function showCompletionPage() {
            showPage('completion-page');
        }
        
        // ============================================
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // íœ´ëŒ€í° ë²ˆí˜¸ ì…ë ¥ ì œí•œ
            document.getElementById('participant-phone').addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
            });
            
            // ì´ë¦„ ì…ë ¥ ì œí•œ (IME í˜¸í™˜ì„± ê°œì„ )
            const nameInput = document.getElementById('participant-name');
            let nameInputTimer;
            
            nameInput.addEventListener('input', function(e) {
                clearTimeout(nameInputTimer);
                nameInputTimer = setTimeout(() => {
                    const value = e.target.value;
                    const filteredValue = value.replace(/[^ê°€-í£\s]/g, '');
                    if (value !== filteredValue) {
                        e.target.value = filteredValue;
                    }
                }, 100);
            });
            
            nameInput.addEventListener('compositionend', function(e) {
                e.target.value = e.target.value.replace(/[^ê°€-í£\s]/g, '');
            });
            
            // ì˜ê²¬ ìˆ˜ì§‘ textarea ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const feedbackTextarea = document.getElementById('participant-feedback');
            if (feedbackTextarea) {
                feedbackTextarea.addEventListener('input', updateCharCount);
                
                feedbackTextarea.addEventListener('paste', function(e) {
                    setTimeout(() => {
                        const maxLength = 2000;
                        if (e.target.value.length > maxLength) {
                            e.target.value = e.target.value.substring(0, maxLength);
                            updateCharCount();
                            showNotification('ìµœëŒ€ 2000ìê¹Œì§€ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'warning');
                        }
                    }, 0);
                });
            }
            
            // ìƒˆ ê·¸ë£¹ ì´ë¦„ ì…ë ¥ ì—”í„°í‚¤ ì§€ì›
            document.getElementById('new-group-name').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    confirmCreateGroup();
                }
            });
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('show');
                    }
                });
            });
            
            // Google Sheets ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            const savedConfig = loadFromStorage('google_sheets_config');
            if (savedConfig) {
                GOOGLE_APPS_SCRIPT_URL = savedConfig.webappUrl || GOOGLE_APPS_SCRIPT_URL;
                SPREADSHEET_ID = savedConfig.spreadsheetId || SPREADSHEET_ID;
            }
            
            console.log('âœ… ì°¸ì—¬ì ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });
    </script>
</body>
</html>